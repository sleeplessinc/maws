<!doctype html>
<html>
<body>

<pre id=dbg_output></pre>

<script src="./sleepless.js"></script>
<script src="./maws.js"></script>
<script>

	var dbg_output = I("dbg_output")

	log = function(s) {
		dbg_output.innerHTML = s+"\n"+dbg_output.innerHTML
		console.log(s)
	} 

	//MAWS.dbg = function(s) { log("MAWS: "+s) }

	cb_msg = function(m) {
		if(m.msg == "ping") {
			m.reply({msg:"pong"});
			return
		}
	}

	cb_ctrl = function(m, x) {
		log("CTRL: "+m+", ["+o2j(x)+"]")

		if(m === "disconnected") {
			log("reconnecting ...");
			setTimeout(function() {
				conn = MAWS.connect(cb_msg, cb_ctrl)
			}, 5000);
			return
		}

		if(m === "connected") {
			conn.send({msg:"hello"}, function(r) {
				log("I've been welcomed as "+r.name)
			});
			return
		}
	}

	conn = MAWS.connect(cb_msg, cb_ctrl)

</script>


